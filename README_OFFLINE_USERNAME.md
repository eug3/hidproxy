# 离线身份验证字功能分析

## 概述

在 xsjzb 中发现了一个初始化/验证函数 `sub_7363F0`，该函数包含硬编码的验证数据，可能与"输入身份验证字"功能相关。

## 发现的硬编码字符串

### 函数 sub_7363F0 (地址: 0x7363F0 - 0x73662F)

该函数在初始化时构建和使用以下硬编码数据：

#### 1. UID 验证
- **地址**: 0x736638
- **值**: "1264495731"
- **用途**: 用于验证 HID 设备的 UID

#### 2. 用户名
- **地址**: 0x736678
- **GB2312 字节**: `BA AB C8 D8 BA AB C8 D8`
- **中文**: `韩蓉韩蓉`
- **用途**: 与 MD5 哈希验证关联

#### 3. 用户名 MD5 哈希
- **地址**: 0x73664C
- **值**: "FBFDE0ED23EC5C6FCFD4D5C94E15A2B1"
- **计算**: MD5(GB2312("韩蓉韩蓉"))
- **用途**: 验证用户名的正确性

#### 4. 公司名称
- **地址**: 0x73668C
- **GB2312 字节**: `BD AD CB D5 BB AA D0 C5 D7 CA B2 FA C6 C0 B9 C0 D3 D0 CF DE B9 AB CB BE`
- **中文**: `江苏华信资产评估有限公司`
- **用途**: 组织标识

#### 5. 神秘字符串
- **地址**: dword_15780D4 数组
- **字节序列**: 
  ```
  BD C3 CB A8 BB C6 D0 F3 D7 BE B2 AB C6 DE B9 D0
  D3 C0 CF C0 B9 FA CB CA C9 C5 BC AA D7 D5 D3 AD
  ```
- **GB2312 解码**: `矫栓黄畜拙搏妻剐永侠国耸膳吉渍迎`
- **长度**: 32 字节 (16 个汉字)
- **用途**: 未知，可能是验证字或加密密钥

#### 6. 版本类型字符串

在相关函数 `sub_7367BC` 中发现的版本标识：

- **地址 0x7368D8**: `企业` (企业版标识符前缀)
- **地址 0x7368E4**: `企业版`
- **地址 0x7368F4**: `标准`
- **地址 0x736904**: `个人`
- **地址 0x73690C**: `核算中心版`

这些字符串用于区分软件的不同版本类型。

## 函数调用关系

### sub_7363F0 函数流程

```c
// 伪代码表示
void sub_7363F0() {
    // 1. 设置版本标志
    word_15780D8 = 12545;  // 0x3101
    word_15780DA = 12801;  // 0x3201
    word_15780DC = 12289;  // 0x3001
    word_15780DE = 12289;  // 0x3001
    
    // 2. 初始化缓冲区
    sub_406C04(16);  // 可能分配16字节缓冲区
    
    // 3. 填充32字节的神秘字符串到 dword_15780D4
    // (代码第39-70行逐字节设置)
    
    // 4. 进行 UID 验证
    sub_405284(..., "1264495731");
    
    // 5. 调用版本检查函数
    sub_7367BC();
    
    // 6. MD5 哈希验证
    sub_405284(..., "FBFDE0ED23EC5C6FCFD4D5C94E15A2B1");
    
    // 7. 使用硬编码的用户名
    sub_405284(..., dword_736678);  // "韩蓉韩蓉"
    
    // 8. 使用硬编码的公司名
    sub_405284(..., dword_73668C);  // "江苏华信资产评估有限公司"
}
```

### sub_7367BC 函数

该函数根据版本标志 (`word_15780D8`, `word_15780DA`) 执行不同的逻辑分支：

- 检查版本类型 (企业、标准、个人、核算中心)
- 根据版本执行相应的初始化或验证流程
- 通过字符串比较确定当前版本

## 可能的离线验证机制

基于发现的数据，可能的"输入身份验证字"工作原理：

### 假设1: 验证字即为神秘字符串

**验证字**: `矫栓黄畜拙搏妻剐永侠国耸膳吉渍迎`

该 32 字节字符串可能是：
- 一个预共享的密钥
- 用户需要输入的验证码
- 算法的输入参数

### 假设2: 版本代码映射

版本标志可能与用户名有对应关系：
- `0x3101 + 0x3201` → 某种运算 → "韩蓉韩蓉"
- 不同的版本标志可能对应不同的用户名

### 假设3: 多重验证

可能需要组合验证：
1. UID: 1264495731
2. 神秘字符串: 矫栓黄畜拙搏妻剐永侠国耸膳吉渍迎
3. 版本类型: 企业版/标准/个人/核算中心版
4. 输出: 用户名 "韩蓉韩蓉"

## 待调查

1. **神秘字符串的用途**
   - 是否为加密密钥？
   - 是否为验证码的一部分？
   - 是否通过某种算法转换为用户名？

2. **版本标志的含义**
   - `word_15780D8 = 12545 (0x3101)`
   - `word_15780DA = 12801 (0x3201)`
   - `word_15780DC = 12289 (0x3001)`
   - `word_15780DE = 12289 (0x3001)`
   - 这些值如何影响验证流程？

3. **函数 sub_1543EB0**
   - 在验证流程中被调用
   - 可能执行某种数据转换
   - 需要进一步反编译分析

4. **注册表或配置文件**
   - 程序导入了 `RegQueryValueExA`, `RegOpenKeyExA` 等注册表函数
   - 可能从注册表读取验证数据
   - 需要搜索注册表键路径

## 验证步骤建议

如果要实现离线验证功能，可能需要：

1. **提取验证字**
   ```
   验证字 = "矫栓黄畜拙搏妻剐永侠国耸膳吉渍迎"
   ```

2. **结合 UID**
   ```
   UID = 1264495731
   ```

3. **应用算法**（未知）
   ```
   用户名 = Algorithm(验证字, UID, 版本标志)
   ```

4. **MD5 验证**
   ```
   if MD5(GB2312(用户名)) == "FBFDE0ED23EC5C6FCFD4D5C94E15A2B1":
       验证通过
   ```

## PowerShell 验证脚本

```powershell
# 验证已知数据的一致性

# 已知用户名
$username = "韩蓉韩蓉"
$usernameBytes = [System.Text.Encoding]::GetEncoding('GB2312').GetBytes($username)

Write-Host "用户名: $username"
Write-Host "GB2312 字节: $($usernameBytes | ForEach-Object { $_.ToString('X2') })"

# 计算 MD5
$md5 = [System.Security.Cryptography.MD5]::Create()
$hash = $md5.ComputeHash($usernameBytes)
$hashString = ($hash | ForEach-Object { $_.ToString('X2') }) -join ''

Write-Host "MD5 哈希: $hashString"
Write-Host "期望哈希: FBFDE0ED23EC5C6FCFD4D5C94E15A2B1"

if ($hashString -eq "FBFDE0ED23EC5C6FCFD4D5C94E15A2B1") {
    Write-Host "✓ 哈希验证通过" -ForegroundColor Green
} else {
    Write-Host "✗ 哈希验证失败" -ForegroundColor Red
}

# 神秘字符串
$mysteryBytes = @(
    0xBD, 0xC3, 0xCB, 0xA8, 0xBB, 0xC6, 0xD0, 0xF3,
    0xD7, 0xBE, 0xB2, 0xAB, 0xC6, 0xDE, 0xB9, 0xD0,
    0xD3, 0xC0, 0xCF, 0xC0, 0xB9, 0xFA, 0xCB, 0xCA,
    0xC9, 0xC5, 0xBC, 0xAA, 0xD7, 0xD5, 0xD3, 0xAD
)
$mysteryString = [System.Text.Encoding]::GetEncoding('GB2312').GetString($mysteryBytes)

Write-Host "`n神秘字符串: $mysteryString"
Write-Host "字节长度: $($mysteryBytes.Length)"
Write-Host "字符长度: $($mysteryString.Length)"
```

## 下一步行动

1. **进一步反编译** `sub_406C04`, `sub_406A48`, `sub_405284` 等关键函数
2. **搜索注册表键** 相关的代码路径，查看是否存储了验证数据
3. **分析 `sub_1543EB0`** 函数的详细逻辑
4. **搜索字符串引用** 查找"矫栓黄畜拙搏妻剐永侠国耸膳吉渍迎"是否在其他地方被使用
5. **检查对话框资源** 查找"输入身份验证字"的 UI 提示文本

## 参考

- 主验证函数: `sub_7363F0` @ 0x7363F0
- 版本检查函数: `sub_7367BC` @ 0x7367BC  
- 数据转换函数: `sub_1543EB0` @ 0x1543EB0
- 相关文档: `README_VERIFICATION.md`
